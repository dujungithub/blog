(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{421:function(t,s,n){"use strict";n.r(s);var a=n(43),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"跨域：配置window版本ngnix进行代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跨域：配置window版本ngnix进行代理"}},[t._v("#")]),t._v(" 跨域：配置window版本ngnix进行代理")]),t._v(" "),n("p",[t._v("1,\t下载nginx http://nginx.org/en/download.html")]),t._v(" "),n("p",[t._v("2,\t启动nginx")]),t._v(" "),n("p",[t._v("​\t\t(1)直接双击nginx.exe，双击后一个黑色的弹窗一闪而过")]),t._v(" "),n("p",[t._v("​\t\t(2)打开cmd命令窗口，切换到nginx解压目录下，输入命令 nginx.exe 或者 start nginx ，回车即可")]),t._v(" "),n("p",[t._v("3,\t检查nginx是否启动成功")]),t._v(" "),n("p",[t._v("​\t\t直接在浏览器地址栏输入网址 http://localhost:80，回车，出现以下页面说明启动成功")]),t._v(" "),n("p",[t._v("​\t\t也可以在cmd命令窗口输入命令 "),n("strong",[t._v('tasklist /fi "imagename eq nginx.exe"')]),t._v(" ，出现如下结果说明启动成功")]),t._v(" "),n("p",[t._v("4,\t修改端口")]),t._v(" "),n("p",[t._v("​\t\tnginx的配置文件是conf目录下的nginx.conf，默认配置的nginx监听的端口为80，如果80端口被占用可以修改为未被占用的端口即可")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("\tserver {\n    listen       80;\n    server_name  localhost;}\n")])])]),n("p",[t._v('​\t\t检查80端口是否被占用的命令是： netstat -ano | findstr 0.0.0.0:80 或 netstat -ano | findstr "80"')]),t._v(" "),n("p",[t._v("​\t\t当我们修改了nginx的配置文件nginx.conf 时，不需要关闭nginx后")]),t._v(" "),n("p",[t._v("​\t\t重新启动nginx，只需要执行命令"),n("strong",[t._v("nginx -s reload")]),t._v(" 即可让改动生效")]),t._v(" "),n("p",[t._v("5,\t关闭nginx")]),t._v(" "),n("p",[t._v("​\t\t如果使用cmd命令窗口启动nginx，关闭cmd窗口是不能结束nginx进程的，可使用两种方法关闭nginx")]),t._v(" "),n("p",[t._v("​\t\t(1)输入nginx命令  nginx -s stop(快速停止nginx)  或  nginx -s quit(完整有序的停止nginx)")]),t._v(" "),n("p",[t._v("​\t\t(2)使用taskkill   taskkill /f /t /im nginx.exe")]),t._v(" "),n("p",[t._v("6,\tnginx配置静态资源")]),t._v(" "),n("p",[t._v("​\t\t将静态资源（如jpg|png|css|js等）放在如下配置的f:/nginx-1.12.2/static目录下，然后在nginx配置文件中\t\t做如下配置(注意：静态资源配置只能放在 location / 中)，浏览器中访问  http://localhost:80/1.png 即可访问到 f:/nginx-1.12.2/static目录下的 1.png图片")]),t._v(" "),n("p",[t._v("7,\t 路由转发代理")]),t._v(" "),n("p",[t._v("​\t\t前端用户访问：nginx服务地址")]),t._v(" "),n("p",[t._v("​\t\tnginx服务地址中前端指向一个地址，后端指向一个地址，解决了前后端跨域问题")]),t._v(" "),n("p",[t._v("​\t\t配置代理服务：服务名自定义api_server,tomcat_server等")]),t._v(" "),n("blockquote",[n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[t._v("listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v(";\n\nserver_name  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),t._v(";\nupstream tomcat_server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tserver localhost"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8008")]),t._v(" weight="),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(";\n\tserver "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("70.128")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8008")]),t._v(" weight="),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(";\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nupstream api_server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tserver "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("70.128")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(";\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nlocation / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n #配置nginx静态资源\n #root\tD"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("/nginx/nginx"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1.12")]),t._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/static/img;\n #nginx配置前端访问入口\n index  index.html index.htm;\n #前端从"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v("端口跳转，访问"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8008")]),t._v("的前端资源\n proxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//tomcat_server;")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nlocation /api "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n proxy_pass   http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//api_server/select;")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n###前端访问：location"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("  静态资源指向"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("70.128")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8008")]),t._v("  后端接口指向"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v("."),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("70.128")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(";\n###完成跨域处理！！！\n\n")])])])]),t._v(" "),n("p",[t._v("​\t\t通过 proxy_pass 可以实现反向代理")]),t._v(" "),n("p",[t._v("​\t\t通过 rewrite 可以实现路由转发")]),t._v(" "),n("p",[t._v("8,\t关于转发地址增加路由入口的处理")]),t._v(" "),n("p",[t._v("​\t\t如：访问：http://192.168.70.128:8888/api/select/ 和访问：http://192.168.70.128:3000/select/应该是一样的。 但是现在http://192.168.70.128:8888/api/select/访问失败")]),t._v(" "),n("p",[t._v("​\t\t解决办法：")]),t._v(" "),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[t._v("    #location /api "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    #\tproxy_pass   http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//api_server/;")]),t._v("\n    #"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t#使用如下方式才可以 api_server是自定义转发地址变量\n\tlocation ^~ /api/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tif ($request_uri ~* "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/api/(.*)"')]),t._v(") "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tproxy_pass http"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//api_server/$1;")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h1",{attrs:{id:"关于localhost访问特别快而nginx配置代理后转发特别慢的解决"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关于localhost访问特别快而nginx配置代理后转发特别慢的解决"}},[t._v("#")]),t._v(" 关于localhost访问特别快而nginx配置代理后转发特别慢的解决")]),t._v(" "),n("p",[t._v("​\t\t前端访问速度特别慢，注意配置中的localhost 改成 127.0.0.1  即可解决！\n​\t\t转发服务为开启的服务建议注释掉，如：#server localhost:8008 weight=2;")]),t._v(" "),n("p",[t._v("nginx  访问接口地址  "),n("a",{attrs:{href:"http://192.168.70.128:8888/api",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://192.168.70.128:8888/api"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("​\t\t    接口转发来自   "),n("a",{attrs:{href:"http://192.168.70.128:3000/select",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://192.168.70.128:3000/select"),n("OutboundLink")],1),t._v("  由node连接数据库mysql的地址")]),t._v(" "),n("p",[t._v("nginx  访问前端地址  "),n("a",{attrs:{href:"http://192.168.70.128:8888/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://192.168.70.128:8888/"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("​\t\t\t前端资源来自   http://192.168.70.128:8008")]),t._v(" "),n("p",[n("img",{attrs:{src:"C:%5CUsers%5Cdujun-zhcw%5CDesktop%5Cnode-koa-mysql-test%5Cassets%5C1558399-20190218162940808-2020359026.png",alt:"img"}})]),t._v(" "),n("p",[n("img",{attrs:{src:"C:%5CUsers%5Cdujun-zhcw%5CDesktop%5Cnode-koa-mysql-test%5Cassets%5C1558399-20190218171357125-1872840115.png",alt:"img"}})]),t._v(" "),n("h2",{attrs:{id:"header配置传参-nginx转发代理-同时转发请求头"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#header配置传参-nginx转发代理-同时转发请求头"}},[t._v("#")]),t._v(" header配置传参-nginx转发代理-同时转发请求头")]),t._v(" "),n("p",[n("img",{attrs:{src:"D:%5Cnginx%5Cnginx-1.12.2%5Cassets%5C1590042442983.png",alt:"1590042442983"}})]),t._v(" "),n("div",{staticClass:"language-nginx extra-class"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("underscores_in_headers")]),t._v(" on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#允许参数带有下划线")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#去除登录验证的请求头添加")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#proxy_set_header xxl_sso_sessionid 'NWVjMjU0YzY0NTcwNmU5MDMzMjUxYjE1XzAxOTk3MTAwODg2YTRkNWM4ZGIwYzE2MjZiZjE2NTUw';")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Host host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("IP remote_addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\n    \t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/api/(.*)"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#proxy_pass http://api_server/$1;")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#proxy_pass https://api_server/$1;")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".35")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".16")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);